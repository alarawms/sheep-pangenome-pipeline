/*
========================================================================================
    Stage 2 Parameter Configuration
========================================================================================
    Additional parameters for genome preprocessing and indexing
========================================================================================
*/

params {
    // ================================================================================
    // Stage 2 Control Parameters
    // ================================================================================

    // Stage execution control
    enable_stage2               = true
    stage2_skip_existing        = false
    stage2_force_rerun          = false

    // Quality control switches
    enable_busco_assessment     = true
    enable_extended_stats       = true
    enable_qc_reports           = true
    enable_chromosome_mapping   = true
    enable_header_normalization = true

    // Indexing control
    enable_bwa_indexing         = true
    enable_minimap2_indexing    = true
    enable_samtools_indexing    = true
    parallel_indexing           = true

    // Reference selection
    enable_reference_selection  = true
    reference_auto_select       = true

    // ================================================================================
    // Sheep-Specific Genome Parameters
    // ================================================================================

    // Expected sheep genome characteristics
    sheep_expected_size         = 2.8e9      // ~2.8 Gb
    sheep_size_tolerance        = 0.25       // ±25% tolerance
    sheep_chromosome_count      = 27         // 26 autosomes + X (MT separate)
    sheep_expected_gc           = [38.0, 45.0]  // Expected GC range
    sheep_expected_n50          = 10e6       // Minimum acceptable N50

    // Sheep chromosome naming scheme
    sheep_chromosomes = [
        'chr1', 'chr2', 'chr3', 'chr4', 'chr5', 'chr6', 'chr7', 'chr8', 'chr9', 'chr10',
        'chr11', 'chr12', 'chr13', 'chr14', 'chr15', 'chr16', 'chr17', 'chr18', 'chr19', 'chr20',
        'chr21', 'chr22', 'chr23', 'chr24', 'chr25', 'chr26', 'chr27', 'chrMT'
    ]

    // ================================================================================
    // Quality Assessment Thresholds
    // ================================================================================

    // Quality tier definitions
    quality_tiers = [
        'A+': [busco_min: 95, n50_min: 50e6, n_max: 1.0],
        'A':  [busco_min: 90, n50_min: 20e6, n_max: 2.0],
        'B+': [busco_min: 85, n50_min: 10e6, n_max: 3.0],
        'B':  [busco_min: 80, n50_min: 5e6,  n_max: 4.0],
        'C+': [busco_min: 75, n50_min: 1e6,  n_max: 5.0],
        'C':  [busco_min: 70, n50_min: 500e3, n_max: 6.0]
    ]

    // BUSCO parameters
    busco_lineage               = 'mammalia_odb10'
    busco_threads               = 16
    busco_timeout               = '24.h'
    busco_min_completeness      = 70.0      // Minimum % for inclusion

    // ================================================================================
    // Resource Allocation
    // ================================================================================

    // Stage 2 resource limits
    stage2_max_memory          = '200.GB'
    stage2_max_cpus            = 32
    stage2_max_time            = '72.h'

    // Process-specific resources
    standardization_memory     = '8.GB'
    standardization_cpus       = 2
    standardization_time       = '4.h'

    busco_memory               = '32.GB'
    busco_cpus                 = 16
    busco_time                 = '24.h'

    indexing_memory            = '24.GB'
    indexing_cpus              = 8
    indexing_time              = '8.h'

    // Memory scaling based on genome size
    memory_per_gb_genome       = '4.GB'     // Additional memory per Gb of genome

    // ================================================================================
    // Output Organization
    // ================================================================================

    // Stage 2 output structure
    stage2_outdir              = "${params.outdir}/02_preprocessing"

    // Subdirectory structure
    standardized_dir           = "${stage2_outdir}/standardized"
    indices_dir                = "${stage2_outdir}/indices"
    qc_dir                     = "${stage2_outdir}/qc_reports"
    stats_dir                  = "${stage2_outdir}/statistics"
    busco_dir                  = "${stage2_outdir}/busco"
    reference_dir              = "${stage2_outdir}/reference_selection"
    mapping_dir                = "${stage2_outdir}/chromosome_mapping"

    // File naming patterns
    standardized_suffix        = '_standardized.fa'
    stats_suffix               = '_extended_stats.json'
    busco_suffix               = '_busco_summary.json'
    qc_suffix                  = '_qc_report.html'

    // ================================================================================
    // Reference Selection Criteria
    // ================================================================================

    // Multi-criteria scoring weights (must sum to 100)
    reference_criteria = [
        assembly_quality: 25,           // Assembly level, contiguity
        completeness: 25,               // BUSCO, chromosome coverage
        sequence_quality: 20,           // Gap content, size accuracy
        annotation_metadata: 15,        // Annotation, RefSeq status
        reference_suitability: 15       // Breed, method, recency
    ]

    // Reference selection preferences
    preferred_assembly_levels  = ['Chromosome', 'Scaffold', 'Contig']
    preferred_breeds           = ['Texel', 'Rambouillet', 'Dorset', 'Suffolk', 'Merino']
    preferred_methods          = ['HiFi', 'PacBio', 'Nanopore', 'ONT']
    minimum_reference_score    = 60     // Minimum score for reference suitability

    // ================================================================================
    // Processing Optimization
    // ================================================================================

    // Parallel processing limits
    max_concurrent_standardization = 10
    max_concurrent_busco          = 3
    max_concurrent_indexing       = 5

    // Batch processing
    batch_size                    = 20
    enable_batching               = true

    // Resource optimization
    dynamic_resource_allocation   = true
    resource_scaling_factor       = 1.0

    // Checkpointing
    enable_stage2_checkpoints     = true
    checkpoint_frequency          = 'per_phase'  // 'per_process', 'per_phase', 'disabled'

    // ================================================================================
    // Validation and Quality Gates
    // ================================================================================

    // Stage 2 → Stage 3 validation gates
    min_genomes_for_pangenome     = 3
    min_avg_quality_score         = 70
    max_failure_rate              = 0.2         // Maximum 20% failures allowed

    // Reference validation requirements
    require_reference_selection   = true
    min_reference_score           = 70
    require_tier_a_reference      = false

    // Quality checks
    strict_quality_mode           = false
    fail_on_low_busco            = false
    warn_on_quality_issues       = true

    // ================================================================================
    // Advanced Options
    // ================================================================================

    // Chromosome renaming options
    force_sheep_naming           = true
    preserve_original_names      = true
    create_mapping_files         = true

    // Header normalization options
    clean_problematic_chars      = true
    standardize_descriptions     = true
    preserve_metadata           = true

    // Statistics options
    calculate_nx_stats          = [10, 20, 25, 30, 40, 50, 60, 70, 75, 80, 90]
    estimate_repeat_content     = true
    analyze_gc_distribution     = true

    // Reporting options
    generate_html_reports       = true
    include_interactive_plots   = true
    create_summary_dashboard    = true

    // ================================================================================
    // Development and Debugging
    // ================================================================================

    // Debug options
    stage2_debug               = false
    verbose_logging            = false
    save_intermediate_files    = false

    // Testing options
    test_mode                  = false
    small_test_dataset         = false
    skip_time_intensive        = false

    // Development flags
    dev_mode                   = false
    experimental_features      = false
}